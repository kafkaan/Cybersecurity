# CVE-2021-36934 (HiveNightmare / SeriousSam)

{% hint style="info" %}
<mark style="color:orange;">**CVE-2021-36934 (HiveNightmare / SeriousSam)**</mark>

* 📆 Été 2021
* 🪟 Affecte : Windows 10
* 📌 Problème : **tous les utilisateurs peuvent lire les fichiers de registre sensibles** (SAM, SYSTEM, SECURITY)
* 🔐 Impact :
  * Lecture de hachages de mots de passe
  * Extraction possible avec `SecretsDump.py`
* ⚙️ Exploit PoC disponible → copie des fichiers vulnérables
* 🛠️ Script disponible pour :
  * **Détection** de la faille
  * **Correction** des ACL
{% endhint %}

<mark style="color:green;">**Checking Permissions on the SAM File**</mark>

{% code fullWidth="true" %}
```cmd-session
C:\htb> icacls c:\Windows\System32\config\SAM
```
{% endcode %}

Successful exploitation also requires the presence of one or more shadow copies. Most Windows 10 systems will have `System Protection` enabled by default which will create periodic backups, including the shadow copy necessary to leverage this flaw.

<mark style="color:green;">**Performing Attack and Parsing Password Hashes**</mark>

This [PoC](https://github.com/GossiTheDog/HiveNightmare) can be used to perform the attack, creating copies of the aforementioned registry hives:

{% code fullWidth="true" %}
```powershell-session
PS C:\Users\htb-student\Desktop> .\HiveNightmare.exe
```
{% endcode %}

These copies can then be transferred back to the attack host, where impacket-secretsdump is used to extract the hashes:

{% code fullWidth="true" %}
```shell-session
impacket-secretsdump -sam SAM-2021-08-07 -system SYSTEM-2021-08-07 -security SECURITY-2021-08-07 local
```
{% endcode %}
