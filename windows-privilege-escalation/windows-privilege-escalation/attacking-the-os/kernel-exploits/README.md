# Kernel Exploits

***

MÃªme lorsquâ€™un ordinateur est ciblÃ© pour lâ€™installation de mises Ã  jour â€” par exemple, en utilisant <mark style="color:orange;">**SCCM (Microsoft System Center Configuration Manager)**</mark> ou <mark style="color:orange;">**WSUS (Windows Server Update Services)**</mark> â€” il existe encore de nombreuses raisons pour lesquelles lâ€™installation peut Ã©chouer.

Au fil des annÃ©es, de nombreuses failles au niveau du noyau ont affectÃ© le systÃ¨me dâ€™exploitation Windows, depuis Windows 2000/XP jusquâ€™Ã  Windows 10/Server 2016/2019.

Ci-dessous se trouve un tableau dÃ©taillÃ© des vulnÃ©rabilitÃ©s connues dâ€™exÃ©cution de code Ã  distance ou dâ€™Ã©lÃ©vation de privilÃ¨ges locales sur les systÃ¨mes Windows, classÃ©es par niveau de Service Pack, depuis Windows XP jusquâ€™Ã  Server 2016.&#x20;

[https://academy.hackthebox.com/module/67/section/627](https://academy.hackthebox.com/module/67/section/627)

***

{% hint style="warning" %}
This [site](https://msrc.microsoft.com/update-guide/vulnerability) is handy for searching out detailed information about Microsoft security vulnerabilities. This database has 4,733 security vulnerabilities entered at the time of writing, showing the massive attack surface that a Windows environment presents.
{% endhint %}

* âœ… **Les anciennes versions de Windows** (XP Ã  Server 2012R2) possÃ¨dent de **nombreuses failles connues**.
* ğŸ”’ **Windows 10 et Server 2016+** sont **mieux sÃ©curisÃ©s**, avec **moins dâ€™exploits connus**, grÃ¢ce Ã  :
  * Des **amÃ©liorations de sÃ©curitÃ©**,
  * La **dÃ©prÃ©ciation** de vieux protocoles (comme **SMBv1**).
* âš ï¸ Lorsquâ€™une nouvelle vulnÃ©rabilitÃ© est dÃ©couverte (ex : **MS17-010 / EternalBlue**), elle affecte souvent **plusieurs versions prÃ©cÃ©dentes** de Windows.
* ğŸ› ï¸ Il est donc **crucial de maintenir les systÃ¨mes Ã  jour**, ou sinon :
  * **Les mettre hors service**,
  * **Les isoler**,
  * **Les remplacer**.
* ğŸ“ˆ Certaines failles (comme MS17-010) permettent Ã  la fois :
  * **L'exÃ©cution de code Ã  distance** (RCE),
  * Et aussi **l'escalade de privilÃ¨ges** si on a dÃ©jÃ  un accÃ¨s local.
* ğŸ’¡ Exemple : si on a un accÃ¨s sur un poste Windows, mais que le port 445 (SMB) est **fermÃ© depuis lâ€™extÃ©rieur**, on peut :
  * Faire du **port forwarding** pour lâ€™exposer Ã  notre machine dâ€™attaque,
  * Ou **exÃ©cuter lâ€™exploit localement** pour obtenir des privilÃ¨ges plus Ã©levÃ©s.

***

### <mark style="color:red;">Notable Vulnerabilities</mark>

&#x20;<mark style="color:orange;">**MS08-067**</mark>

* ğŸ“† AnnÃ©e : 2008
* ğŸ”§ Service : `Server` (RPC)
* ğŸ“Œ Type : **RCE (Ã  distance ou locale via port forwarding)**
* ğŸ“ Versions affectÃ©es :
  * Windows Server 2000, 2003, 2008
  * Windows XP, Vista
* âš ï¸ ExÃ©cution de code en SYSTEM sans authentification
* â— Toujours prÃ©sente dans certaines grandes entreprises (ex : secteur mÃ©dical)
* ğŸ“¦ PrÃ©sente dans la machine **Legacy** (Hack The Box)
* ğŸ’¥ Outils : exploit **standalone** ou **Metasploit**

***

<mark style="color:orange;">**MS17-010 (EternalBlue)**</mark>

* ğŸ“† AnnÃ©e : 2017
* ğŸ› ï¸ Fuite Shadow Brokers â†’ outil **FuzzBunch**
* ğŸ”§ Protocole : SMBv1
* ğŸ“Œ Type : **RCE + LPE via port 445**
* ğŸ§± ProblÃ¨me : gestion incorrecte des paquets SMB â†’ exÃ©cution en SYSTEM
* ğŸ“¦ Machine **Blue** (Hack The Box)
* ğŸ’¥ Outils : exploits **Metasploit** et **standalone**

***

<mark style="color:orange;">**ALPC Task Scheduler 0-Day**</mark>

* ğŸ“† Type : **0-Day Local Privilege Escalation**
* ğŸ”§ Composant : `Task Scheduler` + `Spooler`
* âš™ï¸ Technique :
  * Ã‰criture arbitraire de DACL dans les `.job`
  * Utilisation de `SchRpcSetSecurity` via imprimante XPS
  * DÃ©tournement de DLL â†’ SYSTEM
* ğŸ“¦ Machine **Hackback** (Hack The Box)

***

### <mark style="color:red;">Enumerating Missing Patches</mark>

1. **Commandes utiles (PowerShell ou CMD)** :
   * `systeminfo`
   * `wmic qfe list brief`
   * `Get-Hotfix`
2. **Exemple de sortie avec `wmic qfe list brief`** :
   * Affiche les KB installÃ©s, les dates, lâ€™utilisateur ayant effectuÃ© lâ€™installation, etc.
   * Exemple : `KB5000808` installÃ© le 27/03/2021.
3. **Analyse des KBs** :
   * Chaque **KB** (identifiant de mise Ã  jour) peut Ãªtre recherchÃ© sur le **Microsoft Update Catalog**.
   * Permet de connaÃ®tre la nature de la mise Ã  jour (correctif de sÃ©curitÃ©, update, etc.).
