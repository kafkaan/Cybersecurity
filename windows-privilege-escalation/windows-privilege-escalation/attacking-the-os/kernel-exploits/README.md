# Kernel Exploits

***

Même lorsqu’un ordinateur est ciblé pour l’installation de mises à jour — par exemple, en utilisant <mark style="color:orange;">**SCCM (Microsoft System Center Configuration Manager)**</mark> ou <mark style="color:orange;">**WSUS (Windows Server Update Services)**</mark> — il existe encore de nombreuses raisons pour lesquelles l’installation peut échouer.

Au fil des années, de nombreuses failles au niveau du noyau ont affecté le système d’exploitation Windows, depuis Windows 2000/XP jusqu’à Windows 10/Server 2016/2019.

Ci-dessous se trouve un tableau détaillé des vulnérabilités connues d’exécution de code à distance ou d’élévation de privilèges locales sur les systèmes Windows, classées par niveau de Service Pack, depuis Windows XP jusqu’à Server 2016.&#x20;

[https://academy.hackthebox.com/module/67/section/627](https://academy.hackthebox.com/module/67/section/627)

***

{% hint style="warning" %}
This [site](https://msrc.microsoft.com/update-guide/vulnerability) is handy for searching out detailed information about Microsoft security vulnerabilities. This database has 4,733 security vulnerabilities entered at the time of writing, showing the massive attack surface that a Windows environment presents.
{% endhint %}

* ✅ **Les anciennes versions de Windows** (XP à Server 2012R2) possèdent de **nombreuses failles connues**.
* 🔒 **Windows 10 et Server 2016+** sont **mieux sécurisés**, avec **moins d’exploits connus**, grâce à :
  * Des **améliorations de sécurité**,
  * La **dépréciation** de vieux protocoles (comme **SMBv1**).
* ⚠️ Lorsqu’une nouvelle vulnérabilité est découverte (ex : **MS17-010 / EternalBlue**), elle affecte souvent **plusieurs versions précédentes** de Windows.
* 🛠️ Il est donc **crucial de maintenir les systèmes à jour**, ou sinon :
  * **Les mettre hors service**,
  * **Les isoler**,
  * **Les remplacer**.
* 📈 Certaines failles (comme MS17-010) permettent à la fois :
  * **L'exécution de code à distance** (RCE),
  * Et aussi **l'escalade de privilèges** si on a déjà un accès local.
* 💡 Exemple : si on a un accès sur un poste Windows, mais que le port 445 (SMB) est **fermé depuis l’extérieur**, on peut :
  * Faire du **port forwarding** pour l’exposer à notre machine d’attaque,
  * Ou **exécuter l’exploit localement** pour obtenir des privilèges plus élevés.

***

### <mark style="color:red;">Notable Vulnerabilities</mark>

&#x20;<mark style="color:orange;">**MS08-067**</mark>

* 📆 Année : 2008
* 🔧 Service : `Server` (RPC)
* 📌 Type : **RCE (à distance ou locale via port forwarding)**
* 📍 Versions affectées :
  * Windows Server 2000, 2003, 2008
  * Windows XP, Vista
* ⚠️ Exécution de code en SYSTEM sans authentification
* ❗ Toujours présente dans certaines grandes entreprises (ex : secteur médical)
* 📦 Présente dans la machine **Legacy** (Hack The Box)
* 💥 Outils : exploit **standalone** ou **Metasploit**

***

<mark style="color:orange;">**MS17-010 (EternalBlue)**</mark>

* 📆 Année : 2017
* 🛠️ Fuite Shadow Brokers → outil **FuzzBunch**
* 🔧 Protocole : SMBv1
* 📌 Type : **RCE + LPE via port 445**
* 🧱 Problème : gestion incorrecte des paquets SMB → exécution en SYSTEM
* 📦 Machine **Blue** (Hack The Box)
* 💥 Outils : exploits **Metasploit** et **standalone**

***

<mark style="color:orange;">**ALPC Task Scheduler 0-Day**</mark>

* 📆 Type : **0-Day Local Privilege Escalation**
* 🔧 Composant : `Task Scheduler` + `Spooler`
* ⚙️ Technique :
  * Écriture arbitraire de DACL dans les `.job`
  * Utilisation de `SchRpcSetSecurity` via imprimante XPS
  * Détournement de DLL → SYSTEM
* 📦 Machine **Hackback** (Hack The Box)

***

### <mark style="color:red;">Enumerating Missing Patches</mark>

1. **Commandes utiles (PowerShell ou CMD)** :
   * `systeminfo`
   * `wmic qfe list brief`
   * `Get-Hotfix`
2. **Exemple de sortie avec `wmic qfe list brief`** :
   * Affiche les KB installés, les dates, l’utilisateur ayant effectué l’installation, etc.
   * Exemple : `KB5000808` installé le 27/03/2021.
3. **Analyse des KBs** :
   * Chaque **KB** (identifiant de mise à jour) peut être recherché sur le **Microsoft Update Catalog**.
   * Permet de connaître la nature de la mise à jour (correctif de sécurité, update, etc.).
