# Roles and Services / Restic Exploit

### <mark style="color:red;">Roles and Services</mark>

{% hint style="warning" %}
Les **services** sur un **hôte particulier** peuvent **servir** l'**hôte lui-même** ou d'**autres hôtes** sur le **réseau cible**.\
Il est **nécessaire de créer un profil** de chaque **hôte ciblé**, en **documentant** la **configuration** de ces **services**, leur **objectif**, et comment nous pouvons **potentiellement les utiliser** pour **atteindre nos objectifs d'évaluation**.

Les **rôles et services de serveur typiques** incluent :

* **Serveurs de fichiers et d'impression**,
* **Serveurs web et de bases de données**,
* **Serveurs d’autorité de certification**,
* **Serveurs de gestion de code source**,
* **Serveurs de sauvegarde**.

Prenons les **serveurs de sauvegarde** comme **exemple**, et voyons comment, **si nous compromettons un serveur** ou un **hôte avec un système de sauvegarde**, nous pouvons **compromettre le réseau**.
{% endhint %}

***

#### <mark style="color:green;">Attaquer les serveurs de sauvegarde</mark>

{% hint style="info" %}
En **technologie de l'information**, une **sauvegarde** ou **sauvegarde de données** est **une copie** de **données informatiques** prise et **stockée ailleurs** afin qu'elle puisse être utilisée pour **restaurer l'original** après un **événement de perte de données**.\
Les **sauvegardes** peuvent être utilisées pour **récupérer des données** après une perte due à une **suppression** ou une **corruption**, ou pour **récupérer des données d'un moment antérieur**.\
Les **sauvegardes** fournissent une **forme simple de récupération après sinistre**.\
Certains **systèmes de sauvegarde** peuvent **reconstituer un système informatique** ou d'autres **configurations complexes**, telles qu'un **serveur Active Directory** ou un **serveur de base de données**.

**Typiquement**, les **systèmes de sauvegarde** ont besoin d'un **compte** pour se connecter à la **machine cible** et **effectuer la sauvegarde**.\
La **plupart des entreprises** exigent que les **comptes de sauvegarde** aient des **privilèges administratifs locaux** sur la **machine cible** pour accéder à **tous ses fichiers et services**.

**Si nous obtenons l'accès à un système de sauvegarde**, nous pourrions :

* **examiner les sauvegardes**,
* **chercher des hôtes intéressants**,
* et **restaurer les données** que nous voulons.

Comme nous l'avons **déjà discuté**, nous cherchons des **informations** qui peuvent nous aider à :

* **nous déplacer latéralement** dans le réseau,
* ou **élever nos privilèges**.

Sur notre **machine cible**, **restic** se trouve à `C:\Windows\System32\restic.exe`
{% endhint %}

<mark style="color:green;">**restic - Initialize Backup Directory**</mark>

```powershell-session
mkdir E:\restic2; restic.exe -r E:\restic2 init
```

<mark style="color:green;">**restic - Back up a Directory**</mark>

```powershell-session
$env:RESTIC_PASSWORD = 'Password'
restic.exe -r E:\restic2\ backup C:\SampleFolder
```

{% hint style="warning" %}
If we want to back up a directory such as `C:\Windows`, which has some files actively used by the operating system, we can use the option `--use-fs-snapshot` to create a VSS (Volume Shadow Copy) to perform the backup.
{% endhint %}

<mark style="color:green;">**restic - Back up a Directory with VSS**</mark>

{% code fullWidth="true" %}
```powershell-session
restic.exe -r E:\restic2\ backup C:\Windows\System32\config --use-fs-snapshot
```
{% endcode %}

Note: If the user doesn't have the rights to access or copy the content of a directory, we may get an Access denied message. The backup will be created, but no content will be found.

We can also check which backups are saved in the repository using the `snapshot` command.

<mark style="color:green;">**restic - Check Backups Saved in a Repository**</mark>

```powershell-session
restic.exe -r E:\restic2\ snapshots
```

<mark style="color:green;">**restic - Restore a Backup with ID**</mark>

```powershell-session
restic.exe -r E:\restic2\ restore 9971e881 --target C:\Restore
```

***
