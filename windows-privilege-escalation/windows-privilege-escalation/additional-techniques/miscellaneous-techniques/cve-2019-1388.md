# CVE-2019-1388

### <mark style="color:red;">CVE-2019-1388</mark>

{% hint style="warning" %}
**Type de vulnérabilité :** élévation de privilèges dans le dialogue des certificats Windows.

* **Problème :** le mécanisme UAC ne vérifie pas correctement les privilèges de l’utilisateur lorsqu’il affiche les informations d’un certificat pour un exécutable.
* **Détail technique :**
  * Le champ **Issued By** dans l’onglet Général peut devenir un **hyperlien** si le certificat de l’exécutable contient l’OID `1.3.6.1.4.1.311.2.1.10` (SPC\_SP\_AGENCY\_INFO\_OBJID / SpcSpAgencyInfo).
  * Si ce champ contient un lien, il est rendu cliquable dans le dialogue des certificats.
* **Exploitation :**
  * On peut utiliser un ancien exécutable signé par Microsoft, comme `hhupd.exe`, qui contient un certificat avec ce champ SpcSpAgencyInfo rempli.
  * Cliquer sur le lien ouvre un navigateur **avec les privilèges SYSTEM** (NT AUTHORITY\SYSTEM).
  * À partir du navigateur, on peut « sortir » et lancer `cmd.exe` ou `PowerShell.exe` également avec des privilèges SYSTEM via l’option **View page source**.
* **Méthode pratique :** faire un clic droit sur `hhupd.exe` et sélectionner **Exécuter en tant qu’administrateur**, puis exploiter le lien dans le dialogue des certificats.
{% endhint %}

<figure><img src="../../../../.gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure>

`Show information about the publisher's certificate` to open the certificate dialog. Here we can see that the `SpcSpAgencyInfo` field is populated in the Details tab.

<figure><img src="../../../../.gitbook/assets/image (8).png" alt=""><figcaption></figcaption></figure>

Next, we go back to the General tab and see that the `Issued by` field is populated with a hyperlink. Click on it and then click `OK`, and the certificate dialog will close, and a browser window will launch.

<figure><img src="../../../../.gitbook/assets/image (9).png" alt=""><figcaption></figcaption></figure>

If we open `Task Manager`, we will see that the browser instance was launched as SYSTEM.

<figure><img src="../../../../.gitbook/assets/image (10).png" alt=""><figcaption></figcaption></figure>

Next, we can right-click anywhere on the web page and choose `View page source`. Once the page source opens in another tab, right-click again and select `Save as`, and a `Save As` dialog box will open.

<figure><img src="../../../../.gitbook/assets/image (11).png" alt=""><figcaption></figcaption></figure>

At this point, we can launch any program we would like as SYSTEM. Type `c:\windows\system32\cmd.exe` in the file path and hit enter. If all goes to plan, we will have a cmd.exe instance running as SYSTEM.

<figure><img src="../../../../.gitbook/assets/image (12).png" alt=""><figcaption></figcaption></figure>

Microsoft released a [patch](https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2019-1388) for this issue in November of 2019. Still, as many organizations fall behind on patching, we should always check for this vulnerability if we gain GUI access to a potentially vulnerable system as a low-privilege user.

This [link](https://web.archive.org/web/20210620053630/https://gist.github.com/gentilkiwi/802c221c0731c06c22bb75650e884e5a) lists all of the vulnerable Windows Server and Workstation versions.
