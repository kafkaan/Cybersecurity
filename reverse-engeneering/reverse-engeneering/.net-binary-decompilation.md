# .NET Binary Decompilation

### <mark style="color:blue;">üîç .NET Binary Decompilation</mark> <a href="#dotnet-decompilation" id="dotnet-decompilation"></a>

#### Outils de D√©compilation

**1. ILSpy (Command Line)**

**Installation**

```bash
dotnet tool install --global ilspycmd --version 7.2.1
```

**Utilisation**

```bash
# D√©compilation basique
ilspycmd overwatch.exe > overwatch_decompiled.cs

# Avec m√©tadonn√©es
ilspycmd overwatch.exe -p -o output_dir
```

**2. dnSpy (GUI, Windows)**

```bash
# T√©l√©charger depuis
https://github.com/dnSpy/dnSpy/releases

# Fonctionnalit√©s :
# - D√©bogage en temps r√©el
# - √âdition du code
# - Recompilation
# - Breakpoints
```

**3. dotPeek (JetBrains)**

```bash
# IDE professionnel avec :
# - Navigation avanc√©e
# - Export en projet Visual Studio
# - Analyse des d√©pendances
```

**4. AvaloniaILSpy (GUI, Cross-platform)**

```bash
# Alternative open-source √† ILSpy GUI
https://github.com/icsharpcode/AvaloniaILSpy
```

#### Analyse du Code D√©compil√©

**Recherche de Credentials Hardcod√©s**

```csharp
// Pattern √† chercher :
string connectionString = "Server=localhost;Database=SecurityLogs;User Id=sqlsvc;Password=TI0LKcfHzZw1Vv;";
```

```bash
# Avec grep
grep -i "password\|credential\|secret\|key" overwatch_decompiled.cs

# Expressions r√©guli√®res
grep -E "Password\s*=\s*[\"'][^\"']+[\"']" overwatch_decompiled.cs
```

**Analyse des Vuln√©rabilit√©s**

**1. Command Injection**

```csharp
// VULN√âRABLE
string scriptContents = "Stop-Process -Name " + processName + " -Force";
pipeline.Commands.AddScript(scriptContents);

// S√âCURIS√â
var cmd = new Command("Stop-Process");
cmd.Parameters.Add("Name", processName);
cmd.Parameters.Add("Force");
pipeline.Commands.Add(cmd);
```

**2. SQL Injection**

```csharp
// VULN√âRABLE
string query = "SELECT * FROM users WHERE username = '" + username + "'";

// S√âCURIS√â
SqlCommand cmd = new SqlCommand("SELECT * FROM users WHERE username = @username", conn);
cmd.Parameters.AddWithValue("@username", username);
```

**3. Path Traversal**

```csharp
// VULN√âRABLE
string filePath = "C:\\logs\\" + filename;
File.ReadAllText(filePath);

// S√âCURIS√â
string filePath = Path.Combine("C:\\logs", Path.GetFileName(filename));
if (!filePath.StartsWith("C:\\logs\\")) throw new Exception("Invalid path");
```

#### Modification et Recompilation

**1. Avec dnSpy**

```
1. Ouvrir le .exe dans dnSpy
2. Clic droit sur la m√©thode ‚Üí Edit Method
3. Modifier le code C#
4. File ‚Üí Save Module
5. Tester le nouveau .exe
```

**2. Avec ILSpy + MSBuild**

```bash
# Exporter en projet
ilspycmd -p overwatch.exe -o overwatch_project

# Modifier le code
nano overwatch_project/overwatch.cs

# Recompiler
cd overwatch_project
dotnet build

# Nouveau binaire dans bin/Debug/
```

#### Obfuscation Detection

```bash
# D√©tecter l'obfuscation
strings overwatch.exe | grep -i "confuser\|dotfuscator\|obfuscar"

# Outils de d√©obfuscation
de4dot overwatch.exe
```
